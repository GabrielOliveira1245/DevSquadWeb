<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Atlântica Store - Produtos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div id="conteudo">
  <!-- Cabeçalho -->
  <header class="custom-header py-3 mb-4">
    <div class="container d-flex flex-wrap justify-content-between align-items-center">
      <a href="index.html" class="d-flex align-items-center mb-2 mb-lg-0 text-dark text-decoration-none">
        <img src="images/logo_atlanticastore.jpg" alt="Logo Atlântica Store" width="50" height="50" />
        <span class="fs-4 ms-2">Atlântica Store</span>
      </a>
      <ul class="nav">
        <li class="nav-item"><a href="index.html" class="nav-link link-dark px-2">Início</a></li>
        <li class="nav-item"><a href="produtos.html" class="nav-link link-dark px-2">Produtos</a></li>
        <li class="nav-item"><a href="cadastro.html" class="nav-link link-dark px-2">Cadastro</a></li>
        <li class="nav-item"><a href="carrinho.html" class="nav-link link-dark px-2">Carrinho</a></li>
        <li class="nav-item"><a href="contato.html" class="nav-link link-dark px-2">Contato</a></li>
      </ul>
    </div>
  </header>

  <!-- Produtos Dinâmicos -->
  <section class="container my-5">
    <h2 class="section-title text-center mb-4">Nossos Produtos</h2>
    <div id="produtosList" class="row row-cols-1 row-cols-md-3 g-4"></div>
  </section>

  <!-- Rodapé -->
  <footer class="text-center py-4 mt-5">
    <p>&copy; 2025 Atlântica Store. Todos os direitos reservados.</p>
  </footer>
</div>

<!-- Script de carregamento dinâmico -->
<script type="module">
  async function carregarProdutos() {
    const lista = document.getElementById("produtosList");
    const apiUrl = "http://localhost:8000/api/produtos";

    try {
      const response = await fetch(apiUrl);
      const data = await response.json();

      lista.innerHTML = "";

      data.data.forEach((produto) => {
        const card = document.createElement("div");
        card.className = "col";

        const imagemUrl = produto.imagem
          ? `http://localhost:8000/storage/${produto.imagem}`
          : "images/placeholder.png";

        card.innerHTML = `
          <div class="card h-100">
            <img src="${imagemUrl}" class="card-img-top" alt="${produto.nome}">
            <div class="card-body">
              <h5 class="card-title">${produto.nome}</h5>
              <p class="card-text">Preço: R$ ${parseFloat(produto.preco).toFixed(2)}</p>
              <p class="card-text">Pagamento: ${produto.forma_pagamento}</p>
              <p class="card-text">Estoque: ${produto.quantidade}</p>
              <input type="number" class="form-control mb-2 quantidade" min="1" value="1" max="${produto.quantidade}">
              <button class="btn btn-primary btn-comprar">Comprar</button>
            </div>
          </div>
        `;

        const inputQtd = card.querySelector(".quantidade");
        const botaoComprar = card.querySelector(".btn-comprar");

        botaoComprar.addEventListener("click", () => {
          const quantidade = parseInt(inputQtd.value) || 1;

          if (quantidade < 1) {
            alert("Selecione uma quantidade válida.");
            return;
          }

          const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
          const index = carrinho.findIndex(p => p.id === produto.id);

          if (index !== -1) {
            carrinho[index].quantidade += quantidade;
          } else {
            carrinho.push({
              id: produto.id,
              nome: produto.nome,
              preco: produto.preco,
              imagem: imagemUrl,
              quantidade: quantidade
            });
          }

          localStorage.setItem("carrinho", JSON.stringify(carrinho));
          window.location.href = "carrinho.html";
        });

        lista.appendChild(card);
      });
    } catch (err) {
      console.error("Erro ao carregar produtos:", err);
      lista.innerHTML = "<p class='text-center text-danger'>Erro ao carregar produtos.</p>";
    }
  }

  carregarProdutos();
</script>
</body>
</html>